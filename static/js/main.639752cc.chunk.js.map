{"version":3,"sources":["../node_modules/@ionic/core/dist/esm-es5 lazy /^/.//.*/.entry/.js$/ groupOptions: {} namespace object","../node_modules/ionicons/dist/esm-es5 lazy /^/.//.*/.entry/.js$/ groupOptions: {} namespace object","Globals.tsx","models/Settings.tsx","models/TmpSettings.tsx","redux/reducers/index.tsx","redux/reducers/setReducer.tsx","redux/reducers/tmpSetReducer.tsx","pages/SettingsPage.tsx","components/ShareTextModal.tsx","components/AnimalCell.tsx","pages/BookmarkPage.tsx","pages/ListScreen.tsx","pages/DetailScreen.tsx","components/DownloadModal.tsx","App.tsx","redux/store.tsx","serviceWorkerRegistration.ts","index.tsx"],"names":["map","webpackAsyncContext","req","__webpack_require__","o","Promise","resolve","then","e","Error","code","ids","id","keys","Object","module","exports","pwaUrl","process","database","axiosInstance","axios","create","timeout","url","progressCallback","a","ok","fail","dl","DownloaderHelper","progressUpdateEnable","on","stats","progress","setTimeout","downloadInfo","removeAllListeners","data","fs","readFileSync","filePath","start","fileName","dbOpenReq","indexedDB","open","onsuccess","ev","db","result","trans","transaction","objectStore","get","_ev","console","error","stack","err","transWrite","reqWrite","put","onerror","delete","clear","log","localStorage","consoleLog","bind","consoleError","isMacCatalyst","isPlatform","navigator","platform","Globals","dataUrl","bugReportApiUrl","downloadData","getFileFromIndexedDB","saveFileToIndexedDB","removeFileFromIndexedDB","clearIndexedDB","animalsKey","storeFile","getLog","enableAppLog","Array","from","arguments","apply","disableAppLog","appSettings","fetchErrorContent","className","style","fontSize","paddingTop","href","target","updateApp","serviceWorker","getRegistrations","regs","all","reg","update","newReg","installing","waiting","hasUpdates","reduce","prev","curr","updateCssVars","settings","document","documentElement","cssText","textFontSize","uiFontSize","isTouchDevice","isStoreApps","isMac","clearAppData","copyToClipboard","text","clipboard","writeText","Settings","version","hasAppLog","theme","dbUpdateDate","bookmarks","TmpSettings","fetchError","isLoading","shareTextModal","show","animals","combineReducers","state","action","newSettings","type","bookmark","setItem","JSON","stringify","bookmarksTemp","idxToDel","findIndex","b","uuid","splice","parse","getItem","key","val","body","classList","forEach","test","remove","toggle","length","defaultSettings","undefined","tmpSettings","newState","_SettingsPage","props","reportText","dataDownloadRatio","showUpdateDataDone","showBugReportAlert","showClearAlert","showToast","toastMessage","this","setState","buffer","toString","hidden","tabIndex","icon","shareSocial","slot","onClick","rel","PackageInfos","pwaVersion","fill","shape","size","dispatch","window","location","origin","mainVersion","informationCircle","bug","checked","onIonChange","isChecked","detail","userAgent","cssClass","backdropDismiss","isOpen","header","subHeader","inputs","name","placeholder","buttons","handler","value","post","subject","productName","name0","role","download","flexDirection","textAlign","settingsJsonUri","encodeURIComponent","createElement","click","accept","display","onChange","file","files","item","fileText","getElementById","querySelector","onDidPresent","refreshCircle","width","updateOfflineData","onDidDismiss","message","duration","colorPalette","interface","interfaceOptions","min","max","pin","snaps","helpCircle","React","Component","SettingsPage","withIonLifeCycle","connect","speechRate","voiceURI","_ShareTextModal","isAppSettingsExport","appSettingsString","filter","i","keyVal","join","appUrl","hasQueryString","qrcCanvas","qrcode","showModal","swipeToClose","onWillPresent","push","updateQrCode","finish","height","alignItems","flexGrow","flexShrink","margin","dispFields","AnimalCell","addDel","animalId","newFavorites","oldFavorites","oldId","indexOf","concat","rows","animal","img","album_file","src","alt","helpDoc","_BookmarkPage","bookmarkListRef","reorder","createRef","hasBookmark","history","event","complete","find","animal_id","button","side","color","delBookmarkHandler","current","closeSlidingItems","swapVertical","ref","disabled","onIonItemReorder","reorderBookmarks","getBookmarkRows","BookmarkPage","filters","field","FilterSel","search","_ListScreen","animalsFiltered","filterRegExp","page","animalsLoaded","filtersSel","isScrollOn","fetachDataPageByPage","fromPage0","timer","setInterval","clearInterval","animalsLength","animalsRandomlySelected","v","Math","floor","random","match","params","tab","f","j","clearInput","selectDetail","decodeURIComponent","renderFilterRows","RegExp","thisMatch","renderRows","threshold","onIonInfinite","loadingText","ListScreen","displayItems","_DetailScreen","goBack","arrowBack","addBookmarkHandler","DetailScreen","_DownloadModal","electronBackendApi","store","savedSettingsStr","createStore","reducer","getSavedStore","setupConfig","mode","swipeBackEnabled","serviceWorkCallbacks","onSuccess","registration","onUpdate","_App","AppOrig","_AppOrig","registrationNew","originalAppSettingsStr","wakeLock","receive","send","queryParams","queryString","split","setting","showUpdateAlert","showRestoreAppSettingsToast","downloadModal","speechSynthesis","getVoices","cancel","wakeLockScreen","addEventListener","visibilityState","wakeLockScreenRelease","onupgradeneeded","createObjectStore","loadData","request","release","routeMatches","exec","queryMatches","route","query","to","pathname","animated","path","render","exact","routeByQueryString","list","postMessage","DownloadModal","ShareTextModal","restoreAppSettings","App","withRouter","isLocalhost","Boolean","hostname","registerValidSW","swUrl","config","register","onupdatefound","installingWorker","onstatechange","controller","catch","ReactDOM","URL","fetch","headers","response","contentType","status","ready","unregister","reload","checkValidServiceWorker"],"mappings":"+EAAA,IAAIA,EAAM,CACT,8BAA+B,CAC9B,IACA,GAED,uBAAwB,CACvB,IACA,GAED,uBAAwB,CACvB,IACA,GAED,0BAA2B,CAC1B,IACA,IAED,6BAA8B,CAC7B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,wBAAyB,CACxB,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,sBAAuB,CACtB,IACA,IAED,uBAAwB,CACvB,IACA,IAED,4BAA6B,CAC5B,IACA,IAED,uBAAwB,CACvB,IACA,IAED,qBAAsB,CACrB,IACA,IAED,mCAAoC,CACnC,IACA,IAED,uBAAwB,CACvB,IACA,IAED,+BAAgC,CAC/B,IACA,IAED,wBAAyB,CACxB,IACA,IAED,yBAA0B,CACzB,IACA,IAED,wBAAyB,CACxB,IACA,IAED,uBAAwB,CACvB,IACA,GAED,uBAAwB,CACvB,IACA,IAED,yBAA0B,CACzB,IACA,GAED,8BAA+B,CAC9B,IACA,IAED,yBAA0B,CACzB,IACA,IAED,uBAAwB,CACvB,IACA,IAED,6BAA8B,CAC7B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,+BAAgC,CAC/B,IACA,IAED,yBAA0B,CACzB,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,yBAA0B,CACzB,IACA,IAED,yBAA0B,CACzB,IACA,IAED,4BAA6B,CAC5B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,uBAAwB,CACvB,IACA,IAED,sBAAuB,CACtB,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,uBAAwB,CACvB,IACA,IAED,wBAAyB,CACxB,IACA,IAED,gCAAiC,CAChC,IACA,KAGF,SAASC,EAAoBC,GAC5B,IAAIC,EAAoBC,EAAEJ,EAAKE,GAC9B,OAAOG,QAAQC,UAAUC,MAAK,WAC7B,IAAIC,EAAI,IAAIC,MAAM,uBAAyBP,EAAM,KAEjD,MADAM,EAAEE,KAAO,mBACHF,KAIR,IAAIG,EAAMX,EAAIE,GAAMU,EAAKD,EAAI,GAC7B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","file":"static/js/main.639752cc.chunk.js","sourcesContent":["var map = {\n\t\"./ion-action-sheet.entry.js\": [\n\t\t228,\n\t\t5\n\t],\n\t\"./ion-alert.entry.js\": [\n\t\t229,\n\t\t6\n\t],\n\t\"./ion-app_8.entry.js\": [\n\t\t230,\n\t\t7\n\t],\n\t\"./ion-avatar_3.entry.js\": [\n\t\t231,\n\t\t17\n\t],\n\t\"./ion-back-button.entry.js\": [\n\t\t232,\n\t\t18\n\t],\n\t\"./ion-backdrop.entry.js\": [\n\t\t233,\n\t\t43\n\t],\n\t\"./ion-button_2.entry.js\": [\n\t\t234,\n\t\t19\n\t],\n\t\"./ion-card_5.entry.js\": [\n\t\t235,\n\t\t20\n\t],\n\t\"./ion-checkbox.entry.js\": [\n\t\t236,\n\t\t21\n\t],\n\t\"./ion-chip.entry.js\": [\n\t\t237,\n\t\t22\n\t],\n\t\"./ion-col_3.entry.js\": [\n\t\t238,\n\t\t44\n\t],\n\t\"./ion-datetime_3.entry.js\": [\n\t\t239,\n\t\t10\n\t],\n\t\"./ion-fab_3.entry.js\": [\n\t\t240,\n\t\t23\n\t],\n\t\"./ion-img.entry.js\": [\n\t\t241,\n\t\t45\n\t],\n\t\"./ion-infinite-scroll_2.entry.js\": [\n\t\t242,\n\t\t46\n\t],\n\t\"./ion-input.entry.js\": [\n\t\t243,\n\t\t24\n\t],\n\t\"./ion-item-option_3.entry.js\": [\n\t\t244,\n\t\t25\n\t],\n\t\"./ion-item_8.entry.js\": [\n\t\t245,\n\t\t26\n\t],\n\t\"./ion-loading.entry.js\": [\n\t\t246,\n\t\t27\n\t],\n\t\"./ion-menu_3.entry.js\": [\n\t\t247,\n\t\t28\n\t],\n\t\"./ion-modal.entry.js\": [\n\t\t248,\n\t\t8\n\t],\n\t\"./ion-nav_2.entry.js\": [\n\t\t249,\n\t\t14\n\t],\n\t\"./ion-popover.entry.js\": [\n\t\t250,\n\t\t9\n\t],\n\t\"./ion-progress-bar.entry.js\": [\n\t\t251,\n\t\t29\n\t],\n\t\"./ion-radio_2.entry.js\": [\n\t\t252,\n\t\t30\n\t],\n\t\"./ion-range.entry.js\": [\n\t\t253,\n\t\t31\n\t],\n\t\"./ion-refresher_2.entry.js\": [\n\t\t254,\n\t\t11\n\t],\n\t\"./ion-reorder_2.entry.js\": [\n\t\t255,\n\t\t16\n\t],\n\t\"./ion-ripple-effect.entry.js\": [\n\t\t256,\n\t\t47\n\t],\n\t\"./ion-route_4.entry.js\": [\n\t\t257,\n\t\t32\n\t],\n\t\"./ion-searchbar.entry.js\": [\n\t\t258,\n\t\t33\n\t],\n\t\"./ion-segment_2.entry.js\": [\n\t\t259,\n\t\t34\n\t],\n\t\"./ion-select_3.entry.js\": [\n\t\t260,\n\t\t35\n\t],\n\t\"./ion-slide_2.entry.js\": [\n\t\t261,\n\t\t48\n\t],\n\t\"./ion-spinner.entry.js\": [\n\t\t262,\n\t\t13\n\t],\n\t\"./ion-split-pane.entry.js\": [\n\t\t263,\n\t\t49\n\t],\n\t\"./ion-tab-bar_2.entry.js\": [\n\t\t264,\n\t\t36\n\t],\n\t\"./ion-tab_2.entry.js\": [\n\t\t265,\n\t\t15\n\t],\n\t\"./ion-text.entry.js\": [\n\t\t266,\n\t\t37\n\t],\n\t\"./ion-textarea.entry.js\": [\n\t\t267,\n\t\t38\n\t],\n\t\"./ion-toast.entry.js\": [\n\t\t268,\n\t\t39\n\t],\n\t\"./ion-toggle.entry.js\": [\n\t\t269,\n\t\t12\n\t],\n\t\"./ion-virtual-scroll.entry.js\": [\n\t\t270,\n\t\t50\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 120;\nmodule.exports = webpackAsyncContext;","var map = {\n\t\"./ion-icon.entry.js\": [\n\t\t271,\n\t\t57\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 122;\nmodule.exports = webpackAsyncContext;","import axios from 'axios';\nimport fs from 'fs';\nimport { isPlatform, IonLabel } from '@ionic/react';\nimport { DownloaderHelper, Stats } from 'node-downloader-helper';\nimport { Settings } from './models/Settings';\n\nconst bugReportApiUrl = 'https://vh6ud1o56g.execute-api.ap-northeast-1.amazonaws.com/bugReportMailer';\nconst dataUrl = 'https://data.coa.gov.tw/Service/OpenData/TransService.aspx?UnitId=QcbUEzN6E6DL';\nconst pwaUrl = process.env.PUBLIC_URL || '';\n\nconst database = 'taaDb';\nconst animalsKey = 'animals';\n\nconst axiosInstance = axios.create({\n  timeout: 8000,\n});\n\nasync function downloadData(url: string, progressCallback: Function) {\n  return new Promise<Buffer>((ok, fail) => {\n    const dl = new DownloaderHelper(url, '.', {});\n    let progressUpdateEnable = true;\n    dl.on('progress', (stats: Stats) => {\n      if (progressUpdateEnable) {\n        // Reduce number of this calls by progressUpdateEnable.\n        // Too many of this calls could result in 'end' event callback is executed before 'progress' event callbacks!\n        progressCallback(stats.progress);\n        progressUpdateEnable = false;\n        setTimeout(() => {\n          progressUpdateEnable = true;\n        }, 100);\n      }\n    });\n    dl.on('end', (downloadInfo: any) => {\n      dl.removeAllListeners();\n      const data = fs.readFileSync(downloadInfo.filePath);\n      ok(data);\n    });\n    dl.start();\n  });\n}\n\n\nasync function getFileFromIndexedDB(fileName: string) {\n  const dbOpenReq = indexedDB.open(database);\n\n  return new Promise(function (ok, fail) {\n    dbOpenReq.onsuccess = async function (ev) {\n      const db = dbOpenReq.result;\n\n      try {\n        const trans = db.transaction([\"store\"], 'readwrite');\n        let req = trans.objectStore('store').get(fileName);\n        req.onsuccess = async function (_ev) {\n          const data = req.result;\n          if (!data) {\n            console.error(`${fileName} loading failed!`);\n            console.error(new Error().stack);\n            return fail();\n          }\n          return ok(data);\n        };\n      } catch (err) {\n        console.error(err);\n      }\n    };\n  });\n}\n\nasync function saveFileToIndexedDB(fileName: string, data: any) {\n  const dbOpenReq = indexedDB.open(database);\n  return new Promise<void>((ok, fail) => {\n    dbOpenReq.onsuccess = async (ev: Event) => {\n      const db = dbOpenReq.result;\n\n      const transWrite = db.transaction([\"store\"], 'readwrite')\n      const reqWrite = transWrite.objectStore('store').put(data, fileName);\n      reqWrite.onsuccess = (_ev: any) => ok();\n      reqWrite.onerror = (_ev: any) => fail();\n    };\n  });\n}\n\nasync function removeFileFromIndexedDB(fileName: string) {\n  const dbOpenReq = indexedDB.open(database);\n  return new Promise<void>((ok, fail) => {\n    try {\n      dbOpenReq.onsuccess = (ev: Event) => {\n        const db = dbOpenReq.result;\n\n        const transWrite = db.transaction([\"store\"], 'readwrite')\n        try {\n          const reqWrite = transWrite.objectStore('store').delete(fileName);\n          reqWrite.onsuccess = (_ev: any) => ok();\n          reqWrite.onerror = (_ev: any) => fail();\n        } catch (err) {\n          console.error(err);\n        }\n      };\n    } catch (err) {\n      fail(err);\n    }\n  });\n}\n\nasync function clearIndexedDB() {\n  const dbOpenReq = indexedDB.open(database);\n  return new Promise<void>((ok, fail) => {\n    dbOpenReq.onsuccess = async (ev: Event) => {\n      const db = dbOpenReq.result;\n\n      const transWrite = db.transaction([\"store\"], 'readwrite')\n      const reqWrite = transWrite.objectStore('store').clear();\n      reqWrite.onsuccess = (_ev: any) => ok();\n      reqWrite.onerror = (_ev: any) => fail();\n    };\n  });\n}\n\nlet log = '';\n\nasync function clearAppData() {\n  localStorage.clear();\n}\n\n//const electronBackendApi: any = (window as any).electronBackendApi;\n\nconst consoleLog = console.log.bind(console);\nconst consoleError = console.error.bind(console);\n\nfunction getLog() {\n  return log;\n}\n\nfunction enableAppLog() {\n  console.log = function () {\n    log += '----- Info ----\\n';\n    log += (Array.from(arguments)) + '\\n';\n    consoleLog.apply(console, arguments as any);\n  };\n\n  console.error = function () {\n    log += '----- Error ----\\n';\n    log += (Array.from(arguments)) + '\\n';\n    consoleError.apply(console, arguments as any);\n  };\n}\n\nfunction disableAppLog() {\n  log = '';\n  console.log = consoleLog;\n  console.error = consoleError;\n}\n\nfunction copyToClipboard(text: string) {\n  try {\n    navigator.clipboard && navigator.clipboard.writeText(text);\n  } catch (error) {\n    console.error(error);\n  }\n}\n\nfunction isMacCatalyst() {\n  return isPlatform('ios') && navigator.platform === 'MacIntel';\n}\n\nconst Globals = {\n  pwaUrl,\n  axiosInstance,\n  dataUrl,\n  bugReportApiUrl,\n  database,\n  downloadData,\n  getFileFromIndexedDB,\n  saveFileToIndexedDB,\n  removeFileFromIndexedDB,\n  clearIndexedDB,\n  animalsKey,\n  storeFile: 'taaSettings.json',\n  getLog,\n  enableAppLog,\n  disableAppLog,\n  appSettings: {\n    'theme': '佈景主題',\n    'uiFontSize': 'UI字型大小',\n    'textFontSize': '內容文字大小',\n  } as Record<string, string>,\n  fetchErrorContent: (\n    <div className='contentCenter'>\n      <IonLabel>\n        <div>\n          <div>連線失敗!</div>\n          <div style={{ fontSize: 'var(--ui-font-size)', paddingTop: 24 }}>請嘗試點擊右上方的重新讀取按鈕。如果問題持續發生，請執行<a href={`/${pwaUrl}/settings`} target=\"_self\">設定頁</a>的 app 異常回報功能。</div>\n        </div>\n      </IonLabel>\n    </div>\n  ),\n  updateApp: () => {\n    return new Promise(async resolve => {\n      navigator.serviceWorker.getRegistrations().then(async regs => {\n        const hasUpdates = await Promise.all(regs.map(reg => (reg.update() as any).then((newReg: ServiceWorkerRegistration) => {\n          return newReg.installing !== null || newReg.waiting !== null;\n        })));\n        resolve(hasUpdates.reduce((prev, curr) => prev || curr, false));\n      });\n    });\n  },\n  updateCssVars: (settings: Settings) => {\n    document.documentElement.style.cssText = `--text-font-size: ${settings.textFontSize}px; --ui-font-size: ${settings.uiFontSize}px;`\n  },\n  isMacCatalyst,\n  isTouchDevice: () => {\n    return (isPlatform('ios') && !isMacCatalyst()) || isPlatform('android');\n  },\n  isStoreApps: () => {\n    return isPlatform('pwa') || isPlatform('electron');\n  },\n  isMac: () => {\n    return navigator.platform === 'MacIntel';\n  },\n  clearAppData,\n  copyToClipboard,\n};\n\nexport default Globals;\n","export class Settings {\n    version: number = 1;\n    hasAppLog: boolean = true;\n    theme: number = 3;\n    uiFontSize: number = 24;\n    textFontSize: number = 24;\n    dbUpdateDate: string = '';\n    bookmarks: number[] = [];\n}\n","import { Animal } from \"./Animal\";\n\nexport class TmpSettings {\n    fetchError: boolean = false;\n    isLoading: boolean = false;\n    shareTextModal = { text: '', show: false };\n    animals: Animal[] = [];\n}\n","import { combineReducers } from \"redux\"\n\nimport settings from \"./setReducer\"\nimport tmpSettings from \"./tmpSetReducer\"\n\nexport default combineReducers({\n  settings, tmpSettings\n})\n","import Globals from '../../Globals';\nimport { Settings } from '../../models/Settings';\n\n// Used to store settings. They will be saved to file.\nexport default function reducer(state = new Settings(), action: any) {\n  var newSettings = { ...state };\n  switch (action.type) {\n    case \"ADD_BOOKMARK\":\n      newSettings.bookmarks = [...newSettings.bookmarks, action.bookmark];\n      localStorage.setItem(Globals.storeFile, JSON.stringify({ settings: newSettings }));\n      break;\n    case \"DEL_BOOKMARK\": {\n      let bookmarksTemp = newSettings.bookmarks;\n      const idxToDel = bookmarksTemp.findIndex((b) => { return b === action.uuid });\n      if (idxToDel !== -1) {\n        bookmarksTemp.splice(idxToDel, 1);\n      }\n      newSettings.bookmarks = [...bookmarksTemp];\n      localStorage.setItem(Globals.storeFile, JSON.stringify({ settings: newSettings }));\n      break;\n    }\n    case \"LOAD_SETTINGS\":\n      newSettings = JSON.parse(localStorage.getItem(Globals.storeFile)!).settings;\n      break;\n    case \"SET_KEY_VAL\":\n      var key = action.key;\n      var val = action.val;\n      switch (key) {\n        case 'theme': {\n          document.body.classList.forEach((val) => {\n            if (/theme/.test(val)) {\n              document.body.classList.remove(val);\n            }\n          });\n          document.body.classList.toggle(`theme${val}`, true);\n          break;\n        }\n      }\n\n      (newSettings as any)[key] = val;\n      localStorage.setItem(Globals.storeFile, JSON.stringify({ settings: newSettings }));\n      break;\n    case \"UPDATE_BOOKMARKS\": {\n      newSettings.bookmarks = action.bookmarks;\n      localStorage.setItem(Globals.storeFile, JSON.stringify({ settings: newSettings }));\n      break;\n    }\n    // @ts-ignore\n    case \"DEFAULT_SETTINGS\":\n      newSettings = new Settings();\n      break;\n    // eslint-disable-next-line\n    default:\n      if (Object.keys(newSettings).length === 0) {\n        newSettings = new Settings();\n      }\n      const defaultSettings = new Settings();\n      Object.keys(defaultSettings).forEach(key => {\n        if ((newSettings as any)[key] === undefined) {\n          (newSettings as any)[key] = (defaultSettings as any)[key];\n        }\n      });\n  }\n  return newSettings;\n}\n","import { TmpSettings } from \"../../models/TmpSettings\";\n\n// Used to store temp settings in RAM. They will not be saved to file.\nexport default function reducer(state = new TmpSettings(), action: any) {\n  var newState = { ...state };\n  var key = action.key;\n  var val = action.val;\n  (newState as any)[key] = val;\n  switch (action.type) {\n    case \"TMP_SET_KEY_VAL\": {\n      return newState;\n    }\n    default:\n      break;\n  }\n  return state;\n}\n","import React from 'react';\nimport { IonContent, IonHeader, IonPage, IonTitle, IonToolbar, IonList, IonItem, IonRange, IonIcon, IonLabel, IonToggle, IonButton, IonAlert, IonSelect, IonSelectOption, IonToast, withIonLifeCycle, IonProgressBar } from '@ionic/react';\nimport { connect } from 'react-redux';\nimport { RouteComponentProps } from 'react-router-dom';\nimport Globals from '../Globals';\nimport { helpCircle, text, colorPalette, shareSocial, bug, download, informationCircle, refreshCircle } from 'ionicons/icons';\nimport './SettingsPage.css';\nimport PackageInfos from '../../package.json';\nimport { Settings } from '../models/Settings';\n\ninterface StateProps {\n  dataDownloadRatio: number;\n  showUpdateDataDone: boolean;\n  showBugReportAlert: boolean;\n  showClearAlert: boolean;\n  showToast: boolean;\n  toastMessage: string;\n}\n\ninterface Props {\n  dispatch: Function;\n  hasAppLog: boolean;\n  theme: number;\n  uiFontSize: number;\n  settings: Settings;\n  voiceURI: string;\n  speechRate: number;\n  mainVersion: string | null;\n  cbetaOfflineDbMode: boolean;\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n  label: string;\n}> { }\n\nclass _SettingsPage extends React.Component<PageProps, StateProps> {\n  constructor(props: any) {\n    super(props);\n\n    this.state = {\n      dataDownloadRatio: 0,\n      showUpdateDataDone: false,\n      showBugReportAlert: false,\n      showClearAlert: false,\n      showToast: false,\n      toastMessage: '',\n    };\n  }\n\n  ionViewWillEnter() {\n  }\n\n  async updateOfflineData() {\n    this.setState({ dataDownloadRatio: 0 });\n    const buffer = await Globals.downloadData(Globals.dataUrl, (progress: number) => {\n      this.setState({ dataDownloadRatio: (progress / 100) });\n    });\n    const data = JSON.parse(buffer.toString());\n    Globals.saveFileToIndexedDB(Globals.animalsKey, data);\n    this.setState({ dataDownloadRatio: 1, showUpdateDataDone: true });\n  }\n\n  reportText = '';\n  render() {\n    return (\n      <IonPage>\n        <IonHeader>\n          <IonToolbar>\n            <IonTitle className='uiFont'>設定</IonTitle>\n          </IonToolbar>\n        </IonHeader>\n        <IonContent>\n          <IonList>\n            <IonItem hidden={Globals.isMac()}>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={shareSocial} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont' onClick={async e => {\n                // Disable app update for Mac App Store submission.\n                /*\n                const hasUpdate = await Globals.updateApp();\n\n                if (!hasUpdate) {\n                  this.setState({ showToast: true, toastMessage: 'App 已是最新版' });\n                }*/\n              }}>App 版本: <a href=\"https://github.com/MrMYHuang/taa#history\" target=\"_blank\" rel=\"noreferrer\">{PackageInfos.pwaVersion}</a></IonLabel>\n              <IonButton fill='outline' shape='round' slot='end' size='large' className='uiFont' onClick={e => {\n                this.props.dispatch({\n                  type: \"TMP_SET_KEY_VAL\",\n                  key: 'shareTextModal',\n                  val: {\n                    show: true,\n                    text: window.location.origin,\n                  },\n                });\n              }}>分享</IonButton>\n            </IonItem>\n            <IonItem hidden={!this.props.mainVersion || Globals.isMac()}>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={informationCircle} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont'>Backend app版本: {this.props.mainVersion}</IonLabel>\n              {/*<IonButton fill='outline' shape='round' slot='end' size='large' className='uiFont' onClick={e => {\n              }}>分享</IonButton>*/}\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={bug} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont'>啟用app異常記錄</IonLabel>\n              <IonToggle slot='end' checked={this.props.hasAppLog} onIonChange={e => {\n                const isChecked = e.detail.checked;\n\n                if (this.props.hasAppLog === isChecked) {\n                  return;\n                }\n\n                isChecked ? Globals.enableAppLog() : Globals.disableAppLog();\n                this.props.dispatch({\n                  type: \"SET_KEY_VAL\",\n                  key: 'hasAppLog',\n                  val: isChecked\n                });\n              }} />\n            </IonItem>\n            <IonItem hidden={!this.props.settings.hasAppLog}>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={bug} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont'>回報app異常記錄</IonLabel>\n              <IonButton fill='outline' shape='round' slot='end' size='large' className='uiFont' onClick={e => {\n                this.reportText = \"問題描述(建議填寫)：\\n\\n瀏覽器：\" + navigator.userAgent + \"\\n\\nApp版本：\" + PackageInfos.pwaVersion + \"\\n\\nApp設定：\" + JSON.stringify(this.props.settings) + \"\\n\\nLog：\\n\" + Globals.getLog();\n                this.setState({ showBugReportAlert: true });\n              }}>回報</IonButton>\n              <IonAlert\n                cssClass='uiFont'\n                backdropDismiss={false}\n                isOpen={this.state.showBugReportAlert}\n                header={'異常回報'}\n                subHeader='輸入您的 E-mail，以後續聯絡'\n                inputs={[\n                  {\n                    name: 'name0',\n                    type: 'email',\n                    placeholder: '例：abc@example.com'\n                  },\n                ]}\n                buttons={[\n                  {\n                    text: '送出',\n                    cssClass: 'primary uiFont',\n                    handler: async (value) => {\n                      try {\n                        await Globals.axiosInstance.post(Globals.bugReportApiUrl, {\n                          subject: `${PackageInfos.productName}異常記錄回報`,\n                          text: `E-mail: ${value.name0}\\n${this.reportText}`,\n                        });\n                        this.setState({ showBugReportAlert: false, showToast: true, toastMessage: `異常回報成功` });\n                      } catch (error) {\n                        console.error(error);\n                        this.setState({ showBugReportAlert: false, showToast: true, toastMessage: `異常回報失敗` });\n                      }\n                    },\n                  },\n                  {\n                    text: '取消',\n                    role: 'cancel',\n                    cssClass: 'secondary uiFont',\n                    handler: () => this.setState({ showBugReportAlert: false }),\n                  },\n                ]}\n              />\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={download} slot='start' />\n              <div className='contentBlock'>\n                <div style={{ flexDirection: 'column' }}>\n                  <IonLabel className='ion-text-wrap uiFont'>App 設定</IonLabel>\n                  <div style={{ textAlign: 'right' }}>\n                    <IonButton fill='outline' shape='round' size='large' className='uiFont' onClick={async (e) => {\n                      const settingsJsonUri = `data:text/json;charset=utf-8,${encodeURIComponent(localStorage.getItem(Globals.storeFile) || '')}`;\n                      const a = document.createElement('a');\n                      a.href = settingsJsonUri;\n                      a.download = Globals.storeFile;\n                      a.click();\n                      a.remove();\n                    }}>匯出</IonButton>\n                    <input id='importJsonInput' type='file' accept='.json' style={{ display: 'none' }} onChange={async (ev) => {\n                      const file = ev.target.files?.item(0);\n                      const fileText = await file?.text() || '';\n                      try {\n                        // JSON text validation.\n                        JSON.parse(fileText);\n                        localStorage.setItem(Globals.storeFile, fileText);\n                        this.props.dispatch({ type: 'LOAD_SETTINGS' });\n                      } catch (e) {\n                        console.error(e);\n                        console.error(new Error().stack);\n                      }\n                      (document.getElementById('importJsonInput') as HTMLInputElement).value = '';\n                    }} />\n\n                    <IonButton fill='outline' shape='round' size='large' className='uiFont' onClick={(e) => {\n                      (document.querySelector('#importJsonInput') as HTMLInputElement).click();\n                    }}>匯入</IonButton>\n                    <IonButton fill='outline' shape='round' size='large' className='uiFont' onClick={(e) => {\n                      this.setState({ showClearAlert: true });\n                    }}>重置</IonButton>\n                    <IonAlert\n                      cssClass='uiFont'\n                      isOpen={this.state.showClearAlert}\n                      backdropDismiss={false}\n                      onDidPresent={(ev) => {\n                      }}\n                      header={'重置會還原 app 設定預設值並清除書籤！確定重置？'}\n                      buttons={[\n                        {\n                          text: '取消',\n                          cssClass: 'primary uiFont',\n                          handler: (value) => {\n                            this.setState({\n                              showClearAlert: false,\n                            });\n                          },\n                        },\n                        {\n                          text: '重置',\n                          cssClass: 'secondary uiFont',\n                          handler: async (value) => {\n                            await Globals.clearAppData();\n                            this.props.dispatch({ type: 'DEFAULT_SETTINGS' });\n                            while (document.body.classList.length > 0) {\n                              document.body.classList.remove(document.body.classList.item(0)!);\n                            }\n                            document.body.classList.toggle(`theme${this.props.theme}`, true);\n                            this.setState({ showClearAlert: false, showToast: true, toastMessage: \"清除成功!\" });\n                          },\n                        }\n                      ]}\n                    />\n                  </div>\n                </div>\n              </div>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={refreshCircle} slot='start' />\n              <div style={{ width: '100%' }}>\n                <IonLabel className='ion-text-wrap uiFont'>更新離線認養動物資料</IonLabel>\n                <IonProgressBar value={this.state.dataDownloadRatio} />\n              </div>\n              <IonButton fill='outline' shape='round' slot='end' size='large' className='uiFont' onClick={async (e) => this.updateOfflineData()}>更新</IonButton>\n              <IonToast\n                cssClass='uiFont'\n                isOpen={this.state.showUpdateDataDone}\n                onDidDismiss={() => this.setState({ showUpdateDataDone: false })}\n                message={`離線認養動物資料更新完畢！`}\n                duration={2000}\n              />\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={colorPalette} slot='start' />\n              <IonLabel className='ion-text-wrap uiFont'>{Globals.appSettings['theme']}</IonLabel>\n              <IonSelect slot='end'\n                value={+this.props.theme}\n                className='uiFont'\n                interface='popover'\n                interfaceOptions={{ cssClass: 'taathemes' }}\n                onIonChange={e => {\n                  const value = +e.detail.value;\n                  // Important! Because it can results in rerendering of this component but\n                  // store states (this.props) of this component is not updated yet! And IonSelect value will be changed\n                  // back to the old value and onIonChange will be triggered again!\n                  // Thus, we use this check to ignore this invalid change.\n                  if (+this.props.theme === value) {\n                    return;\n                  }\n\n                  this.props.dispatch({\n                    type: \"SET_KEY_VAL\",\n                    key: 'theme',\n                    val: value,\n                  });\n                }}>\n                <IonSelectOption className='uiFont cbeta' value={0}>綠底</IonSelectOption>\n                <IonSelectOption className='uiFont dark' value={1}>暗色</IonSelectOption>\n                <IonSelectOption className='uiFont light' value={2}>亮色</IonSelectOption>\n                <IonSelectOption className='uiFont oldPaper' value={3}>舊書</IonSelectOption>\n                <IonSelectOption className='uiFont marble' value={4}>大理石</IonSelectOption>\n              </IonSelect>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={text} slot='start' />\n              <div className=\"contentBlock\">\n                <div style={{ flexDirection: \"column\" }}>\n                  <IonLabel className='ion-text-wrap uiFont'>{Globals.appSettings['uiFontSize']}: {this.props.uiFontSize}</IonLabel>\n                  <IonRange min={12} max={32} pin={true} snaps={true} value={this.props.uiFontSize} onIonChange={e => {\n                    this.props.dispatch({\n                      type: \"SET_KEY_VAL\",\n                      key: 'uiFontSize',\n                      val: e.detail.value,\n                    });\n                    Globals.updateCssVars(this.props.settings);\n                  }} />\n                </div>\n              </div>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={text} slot='start' />\n              <div className=\"contentBlock\">\n                <IonLabel className='ion-text-wrap uiFont'>{Globals.appSettings['textFontSize']}: <span className='textFont'>{this.props.settings.textFontSize}</span></IonLabel>\n                <IonRange min={12} max={64} pin={true} snaps={true} value={this.props.settings.textFontSize} onIonChange={e => {\n                  this.props.dispatch({\n                    type: \"SET_KEY_VAL\",\n                    key: 'textFontSize',\n                    val: e.detail.value,\n                  });\n                  Globals.updateCssVars(this.props.settings);\n                }} />\n              </div>\n            </IonItem>\n            <IonItem>\n              <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n              <IonIcon icon={helpCircle} slot='start' />\n              <div className='uiFont'>\n                <div>關於</div>\n                <div hidden={Globals.isMac()}><a href=\"https://github.com/MrMYHuang/taa\" target=\"_blank\" rel=\"noreferrer\">操作說明與開放原始碼</a></div>\n                <div>作者: Meng-Yuan Huang</div>\n                <div><a href=\"mailto:myh@live.com\" target=\"_blank\" rel=\"noreferrer\">myh@live.com</a></div>\n              </div>\n            </IonItem>\n          </IonList>\n\n          <IonToast\n            cssClass='uiFont'\n            isOpen={this.state.showToast}\n            onDidDismiss={() => this.setState({ showToast: false })}\n            message={this.state.toastMessage}\n            duration={2000}\n          />\n        </IonContent>\n      </IonPage >\n    );\n  }\n};\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n    settings: state.settings,\n    hasAppLog: state.settings.hasAppLog,\n    theme: state.settings.theme,\n    uiFontSize: state.settings.uiFontSize,\n    speechRate: state.settings.speechRate,\n    voiceURI: state.settings.voiceURI,\n    mainVersion: state.tmpSettings.mainVersion,\n  }\n};\n\nconst SettingsPage = withIonLifeCycle(_SettingsPage);\n\nexport default connect(\n  mapStateToProps,\n)(SettingsPage);\n","import React from 'react';\nimport { IonButton, IonContent, IonItem, IonLabel, IonList, IonModal, IonToggle } from '@ionic/react';\nimport { RouteComponentProps } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport Globals from '../Globals';\nimport * as qrcode from 'qrcode';\n\ninterface Props {\n  showModal: boolean;\n  text: string;\n  finish: Function;\n  settings: any;\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n}> { }\n\ninterface State {\n  isAppSettingsExport: Array<boolean>;\n}\n\nclass _ShareTextModal extends React.Component<PageProps, State> {\n\n  constructor(props: any) {\n    super(props);\n    this.state = {\n      isAppSettingsExport: Array<boolean>(Object.keys(Globals.appSettings).length)\n    }\n  }\n\n  updateQrCode() {\n    const appSettingsExport = Object.keys(Globals.appSettings).filter((key, i) => this.state.isAppSettingsExport[i]).map((key, i) => {return {key: key, val: this.props.settings[key]};});\n    let appSettingsString: string | null = appSettingsExport.map(keyVal => `${keyVal.key}=${+keyVal.val}`).join(',');\n    appSettingsString = appSettingsString !== '' ? `settings=${appSettingsString}` : null;\n    let appUrl = this.props.text;\n    const hasQueryString = /\\?/.test(appUrl);\n    if (appSettingsString) {\n      appUrl += hasQueryString ? `&${appSettingsString}` : `?${appSettingsString}`;\n    }\n    \n    Globals.copyToClipboard(appUrl);\n    const qrcCanvas = document.getElementById('qrcCanvas');\n    qrcode.toCanvas(qrcCanvas, appUrl);\n    return qrcCanvas;\n  }\n\n  render() {\n    return (\n      <IonModal\n        isOpen={this.props.showModal}\n        cssClass='uiFont'\n        swipeToClose={true}\n        //presentingElement={router || undefined}\n        onWillPresent={() => {\n          let isAppSettingsExport: Array<boolean> = [];\n          for (let i = 0; i < this.state.isAppSettingsExport.length; i++) {\n            isAppSettingsExport.push(false);\n          }\n          this.setState({isAppSettingsExport: isAppSettingsExport});\n          this.updateQrCode();\n        }}\n        onDidDismiss={() => this.props.finish()}>\n        <IonContent>\n          <div style={{ display: 'flex', flexDirection: 'column', height: '100%', alignItems: 'center' }}>\n            <div>\n              <IonLabel className='uiFont'>此頁app連結已複製至剪貼簿！</IonLabel>\n            </div>\n            <div>\n              <IonLabel className='uiFont'>也可以使用QR Code分享:</IonLabel>\n            </div>\n            <div style={{ flexGrow: 1, flexShrink: 0, display: 'flex', alignItems: 'center', margin: 10 }}>\n              <canvas id='qrcCanvas' width='500' height='500' style={{ margin: '0px auto' }} />\n            </div>\n            <div>\n              <IonLabel className='uiFont'>包括app設定:</IonLabel>\n              <IonList>\n                {\n                  Object.keys(Globals.appSettings).map((key, i) =>\n                    <IonItem key={`appSettingExportItem_${i}`}>\n                      <IonLabel className='ion-text-wrap uiFont'>{Globals.appSettings[key]}</IonLabel>\n                      <IonToggle slot='end' onIonChange={e => {\n                        const isAppSettingsExport =  this.state.isAppSettingsExport;\n                        isAppSettingsExport[i] = e.detail.checked;\n                        this.setState({isAppSettingsExport: isAppSettingsExport});\n                        this.updateQrCode();\n                      }} />\n                    </IonItem>\n                  )\n                }\n              </IonList>\n            </div>\n            <div>\n              <IonButton fill='outline' shape='round' size='large' onClick={() => this.props.finish()}>關閉</IonButton>\n            </div>\n          </div>\n        </IonContent>\n      </IonModal>\n    );\n  }\n};\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n    settings: state.settings,\n  }\n};\n\n//const mapDispatchToProps = {};\n\nexport default connect(\n  mapStateToProps,\n)(_ShareTextModal);\n","import React from 'react';\nimport { IonLabel, IonThumbnail, IonImg } from '@ionic/react';\nimport { RouteComponentProps } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport { Settings } from '../models/Settings';\nimport { TmpSettings } from '../models/TmpSettings';\nimport { Animal } from '../models/Animal';\n\ninterface Props {\n  animal: Animal;\n  dispatch: Function;\n  settings: Settings;\n  tmpSettings: TmpSettings;\n}\n\ninterface State {\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n}> { }\n\nvar dispFields = [\"性別\", \"年紀\", \"開放認養時間(起)\", \"所屬收容所名稱\", \"異動時間\"]\n\nvar keys = [\"animal_sex\", \"animal_age\", \"animal_opendate\", \"shelter_name\", \"cDate\"]\n\nclass _AnimalCell extends React.Component<PageProps, State> {\n  async modifyFavorites(addDel: number, animalId: number) {\n    let newFavorites: number[] = [];\n    let oldFavorites = this.props.settings.bookmarks;\n\n    let oldId;\n    // Init add\n    if (oldFavorites === undefined) {\n      newFavorites = [animalId]\n    }\n    else {\n      oldId = oldFavorites.indexOf(animalId)\n      // Add\n      if (addDel === 0) {\n        // Check duplicate.\n        if (oldId !== -1)\n          return\n\n        newFavorites = [animalId]\n        newFavorites = newFavorites.concat(oldFavorites)\n      }\n      // Del\n      else if (addDel === 1) {\n        oldFavorites.splice(oldId, 1)\n        newFavorites = oldFavorites\n      }\n    }\n\n    await this.props.dispatch({\n      type: \"SET_KEY_VAL\",\n      key: \"bookmarks\",\n      val: newFavorites\n    })\n  }\n\n  render() {\n    var rows = [];\n    for (var i = 0; i < keys.length; i++) {\n      rows.push(<div key={`text${i}`}>&bull; {dispFields[i] + \"：\" + (this.props.animal as any)[keys[i]]}</div>);\n    }\n\n    var img = this.props.animal.album_file;\n\n    return (<>\n      <IonThumbnail slot='start' className='animalCellImg'>\n        <IonImg src={img} alt='' />\n      </IonThumbnail>\n      <IonLabel className='ion-text-wrap'>\n        {rows}\n      </IonLabel>\n    </>);\n  }\n}\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n    tmpSettings: state.tmpSettings,\n    settings: state.settings\n  }\n};\n\n//const mapDispatchToProps = { };\n\nconst AnimalCell = _AnimalCell;\n\nexport default connect(\n  mapStateToProps,\n)(AnimalCell);\n","import React from 'react';\nimport { IonContent, IonHeader, IonPage, IonTitle, IonToolbar, IonList, IonReorderGroup, IonReorder, IonItem, withIonLifeCycle, IonItemSliding, IonItemOptions, IonItemOption, IonIcon, IonButton, IonToast, IonLoading, IonLabel } from '@ionic/react';\nimport { ItemReorderEventDetail } from '@ionic/core';\nimport { RouteComponentProps } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport { swapVertical } from 'ionicons/icons';\nimport Globals from '../Globals';\nimport { Settings } from '../models/Settings';\nimport { TmpSettings } from '../models/TmpSettings';\nimport AnimalCell from '../components/AnimalCell';\n\ninterface Props {\n  dispatch: Function;\n  tmpSettings: TmpSettings;\n  settings: Settings;\n  fontSize: number;\n}\n\ninterface State {\n  reorder: boolean;\n  showToast: boolean;\n  toastMessage: string;\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n}> { }\n\nconst helpDoc = Globals.isStoreApps() ?\n  <></>\n  :\n  <>\n    <div style={{ fontSize: 'var(--ui-font-size)', textAlign: 'center' }}><a href=\"https://github.com/MrMYHuang/twdi#web-app\" target=\"_blank\" rel=\"noreferrer\">程式安裝說明</a></div>\n    <div style={{ fontSize: 'var(--ui-font-size)', textAlign: 'center' }}><a href=\"https://github.com/MrMYHuang/twdi#shortcuts\" target=\"_blank\" rel=\"noreferrer\">程式捷徑</a></div>\n  </>;\n\nclass _BookmarkPage extends React.Component<PageProps, State> {\n  bookmarkListRef: React.RefObject<HTMLIonListElement>;\n  constructor(props: any) {\n    super(props);\n    this.state = {\n      reorder: false,\n      showToast: false,\n      toastMessage: '',\n    }\n    this.bookmarkListRef = React.createRef<HTMLIonListElement>();\n  }\n\n  ionViewWillEnter() {\n    if (!this.hasBookmark) {\n      this.setState({ showToast: true, toastMessage: '無書籤！請至動物詳細資料新增書籤。' });\n      this.props.history.push(`${Globals.pwaUrl}/animals`);\n    }\n    //console.log( 'view will enter' );\n  }\n\n  get hasBookmark() {\n    return this.props.settings.bookmarks.length > 0;\n  }\n\n  delBookmarkHandler(uuid: number) {\n    this.props.dispatch({\n      type: \"DEL_BOOKMARK\",\n      uuid: uuid,\n    });\n\n    if (!this.hasBookmark) {\n      this.setState({ showToast: true, toastMessage: '無書籤！請將任認養動物加至書籤。' });\n      this.props.history.push(`${Globals.pwaUrl}/animals`);\n    }\n  }\n\n  reorderBookmarks(event: CustomEvent<ItemReorderEventDetail>) {\n    const bookmarks = event.detail.complete(this.props.settings.bookmarks);\n    this.props.dispatch({\n      type: \"UPDATE_BOOKMARKS\",\n      bookmarks: bookmarks,\n    });\n  }\n\n  getBookmarkRows() {\n    let bookmarks = this.props.settings.bookmarks;\n    let rows = Array<object>();\n    bookmarks.forEach((animalId, i) => {\n      let animal = this.props.tmpSettings.animals.find((a) => a.animal_id === animalId);\n      rows.push(\n        <IonItemSliding key={`bookmarkItemSliding_` + i}>\n          <IonItem key={`bookmarkItem_` + i} button={true}\n            onClick={e =>\n              this.props.history.push(`${Globals.pwaUrl}/animals/${animalId}`)\n            }>\n            <div tabIndex={0}></div>{/* Workaround for macOS Safari 14 bug. */}\n            {animal == null ?\n              <IonLabel className='uiFont'>\n                資料庫已無此動物，請刪除此項目。\n              </IonLabel>\n              :\n              <AnimalCell\n                {...{\n                  animal: animal,\n                  ...this.props\n                }}\n              />\n            }\n            <IonReorder slot='end' />\n          </IonItem>\n\n          <IonItemOptions side=\"end\">\n            <IonItemOption className='uiFont' color='danger' onClick={(e) => {\n              this.delBookmarkHandler(animalId);\n              this.bookmarkListRef.current?.closeSlidingItems();\n            }}>刪除</IonItemOption>\n          </IonItemOptions>\n        </IonItemSliding>\n      );\n    });\n    return rows;\n  }\n\n  render() {\n    return (\n      <IonPage>\n        <IonHeader>\n          <IonToolbar>\n            <IonTitle className='uiFont'>書籤</IonTitle>\n\n            <IonButton fill={this.state.reorder ? 'solid' : 'clear'} slot='end'\n              onClick={ev => this.setState({ reorder: !this.state.reorder })}>\n              <IonIcon icon={swapVertical} slot='icon-only' />\n            </IonButton>\n          </IonToolbar>\n        </IonHeader>\n        <IonContent>\n          {\n            this.props.tmpSettings.isLoading ?\n              <IonLoading\n                cssClass='uiFont'\n                isOpen={this.props.tmpSettings.isLoading}\n                message={'載入中...'}\n              />\n              :\n              this.hasBookmark ?\n                <>\n                  <IonList key='bookmarkList0' ref={this.bookmarkListRef}>\n                    <IonReorderGroup disabled={!this.state.reorder} onIonItemReorder={(event: CustomEvent<ItemReorderEventDetail>) => { this.reorderBookmarks(event); }}>\n                      {this.getBookmarkRows()}\n                    </IonReorderGroup>\n                  </IonList>\n                  {helpDoc}\n                </>\n                :\n                <>\n                </>\n          }\n\n          <IonToast\n            cssClass='uiFont'\n            isOpen={this.state.showToast}\n            onDidDismiss={() => this.setState({ showToast: false })}\n            message={this.state.toastMessage}\n            duration={2000}\n          />\n        </IonContent>\n      </IonPage>\n    );\n  }\n};\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n    bookmarks: state.settings.bookmarks,\n    settings: state.settings,\n    tmpSettings: state.tmpSettings,\n  }\n};\n\n//const mapDispatchToProps = {};\n\nconst BookmarkPage = withIonLifeCycle(_BookmarkPage);\n\nexport default connect(\n  mapStateToProps,\n)(BookmarkPage);\n","import React from 'react';\nimport { IonContent, IonHeader, IonPage, IonTitle, IonToolbar, withIonLifeCycle, IonButton, IonIcon, IonList, IonItem, IonToast, IonInfiniteScroll, IonInfiniteScrollContent, IonLoading, IonSelect, IonSelectOption, IonInput, IonLabel } from '@ionic/react';\nimport { RouteComponentProps } from 'react-router-dom';\nimport { connect } from 'react-redux';\n\n\nimport { Settings } from '../models/Settings';\nimport { TmpSettings } from '../models/TmpSettings';\nimport Globals from '../Globals';\nimport { shareSocial } from 'ionicons/icons';\n\nimport './ListScreen.css';\nimport { Animal } from '../models/Animal';\nimport AnimalCell from '../components/AnimalCell';\n\nclass Filter {\n  field: string = '';\n  key: string = '';\n}\n\nconst filters: Filter[] = [\n  { field: \"類型\", key: \"animal_kind\" },\n  { field: \"地址\", key: \"shelter_address\" },\n  { field: \"所屬收容所名稱\", key: \"shelter_name\" },\n  { field: \"性別\", key: \"animal_sex\" },\n  { field: \"毛色\", key: \"animal_colour\" },\n  { field: \"體型\", key: \"animal_bodytype\" },\n  { field: \"是否絕育\", key: \"animal_sterilization\" },\n  { field: \"是否施打狂犬病疫苗\", key: \"animal_bacterin\" },\n  { field: \"流水編號\", key: \"animal_id\" },\n  { field: \"區域編號\", key: \"animal_subid\" },\n  { field: \"聯絡電話\", key: \"shelter_tel\" },\n  { field: \"實際所在地\", key: \"animal_place\" },\n  { field: \"年紀\", key: \"animal_age\" },\n  { field: \"尋獲地\", key: \"animal_foundplace\" },\n  { field: \"狀態\", key: \"animal_status\" },\n  { field: \"開放認養時間(起)\", key: \"animal_opendate\" },\n  { field: \"開放認養時間(迄)\", key: \"animal_closeddate\" },\n  { field: \"資料異動時間\", key: \"animal_update\" },\n  { field: \"資料建立時間\", key: \"animal_createtime\" },\n];\n\nclass FilterSel {\n  id: number = 0;\n  key: string = 'animal_kind';\n  search: string = '';\n\n}\n\ninterface Props {\n  dispatch: Function;\n  settings: Settings;\n  tmpSettings: TmpSettings;\n}\n\ninterface State {\n  animalsLoaded: Animal[];\n  filtersSel: FilterSel[]\n  isScrollOn: boolean;\n  showToast: boolean;\n  toastMessage: string;\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n}> { }\n\nclass _ListScreen extends React.Component<PageProps, State> {\n  animalsFiltered: Animal[] = [];\n\n  constructor(props: any) {\n    super(props);\n    this.state = {\n      animalsLoaded: [],\n      filtersSel: [new FilterSel()],\n      isScrollOn: false,\n      showToast: false,\n      toastMessage: '',\n    };\n\n    this.fetachDataPageByPage(true);\n  }\n\n  filterRegExp: RegExp[] = [];\n\n  page = 0;\n  rows = 20;\n  async fetachDataPageByPage(fromPage0: boolean = false) {\n    await new Promise<void>((ok, fail) => {\n      let timer = setInterval(() => {\n        if (!this.props.tmpSettings.isLoading) {\n          // Initialization.\n          if (this.animalsFiltered.length === 0 && this.filterRegExp.length === 0) {\n            this.animalsFiltered = this.props.tmpSettings.animals;\n          }\n          clearInterval(timer);\n          ok();\n        }\n      }, 50);\n    });\n\n    if (fromPage0) {\n      this.page = 0;\n    }\n\n    console.log(`Loading page ${this.page}`);\n\n    const animalsLength = this.animalsFiltered.length;\n\n    const animalsRandomlySelected = (new Array(this.rows).fill(0)).map(v => this.animalsFiltered[Math.floor(Math.random() * animalsLength)]).filter(a => a != null);\n\n    this.page += 1;\n    this.setState({\n      animalsLoaded: fromPage0 ? animalsRandomlySelected : [...this.state.animalsLoaded, ...animalsRandomlySelected],\n      isScrollOn: this.state.animalsLoaded.length < animalsLength,\n    });\n\n    return true;\n  }\n\n  async selectDetail(animalId: number) {\n    this.props.history.push(`${Globals.pwaUrl}/${this.props.match.params.tab}/${animalId}`);\n  }\n\n  renderFilterRows() {\n    return this.state.filtersSel.map((fs, i) => {\n      return <IonItem className='uiFont' key={`filterRow${i}`}>\n        <IonLabel className='uiFont'>條件：</IonLabel>\n        <IonSelect\n          value={this.state.filtersSel[i].id}\n          className='uiFont ionSelect'\n          interface='popover'\n          onIonChange={e => {\n            const value = +e.detail.value;\n            // Important! Because it can results in rerendering of this component but\n            // store states (this.props) of this component is not updated yet! And IonSelect value will be changed\n            // back to the old value and onIonChange will be triggered again!\n            // Thus, we use this check to ignore this invalid change.\n            if (+this.state.filtersSel[i].id === value) {\n              return;\n            }\n\n            let filtersSel = this.state.filtersSel;\n            filtersSel[i].id = value;\n            filtersSel[i].key = filters[value].key;\n            this.setState({ filtersSel: filtersSel });\n          }}\n        >\n          {\n            filters.map((f, j) => <IonSelectOption className='uiFont' key={`selOpt${j}`} value={j}>\n              {f.field}\n            </IonSelectOption>)\n          }\n        </IonSelect>\n\n        <IonLabel className='uiFont'>符合：</IonLabel>\n        <IonInput\n          value={this.state.filtersSel[i].search}\n          className='ionInput'\n          clearInput={true}\n          onIonChange={e => {\n            let filtersSel = this.state.filtersSel;\n            filtersSel[i].search = e.detail.value || '';\n            this.setState({ filtersSel })\n          }}></IonInput>\n\n        <IonButton fill='outline' shape='round' size='large' className='uiFont' onClick={e => {\n          this.state.filtersSel.splice(i, 1);\n          this.setState({ filtersSel: this.state.filtersSel });\n        }}>刪除</IonButton>\n      </IonItem>\n    });\n  }\n\n  renderRows() {\n    return this.state.animalsLoaded.map((a, i) =>\n      <IonItem className='textFont' button={true} key={`item${i}`} onClick={(e) => {\n        this.selectDetail(a.animal_id);\n      }}>\n        <AnimalCell\n          {...{\n            animal: a,\n            ...this.props\n          }}\n        />\n      </IonItem>);\n  }\n\n  render() {\n    return (\n      this.props.tmpSettings.isLoading ?\n        <IonLoading\n          cssClass='uiFont'\n          isOpen={this.props.tmpSettings.isLoading}\n          message={'載入中...'}\n        />\n        :\n        <IonPage>\n          <IonHeader>\n            <IonToolbar>\n              <IonTitle className='uiFont'>認養動物</IonTitle>\n\n              <IonButton fill=\"clear\" slot='end' onClick={e => {\n                this.props.dispatch({\n                  type: \"TMP_SET_KEY_VAL\",\n                  key: 'shareTextModal',\n                  val: {\n                    show: true,\n                    text: decodeURIComponent(window.location.href),\n                  },\n                });\n              }}>\n                <IonIcon icon={shareSocial} slot='icon-only' />\n              </IonButton>\n            </IonToolbar>\n          </IonHeader>\n          <IonContent style={{ textAlign: 'center' }}>\n\n            <IonList>\n              {this.renderFilterRows()}\n            </IonList>\n\n            <IonButton fill='outline' shape='round' size='large' className='uiFont' onClick={e => {\n              this.state.filtersSel.push(new FilterSel());\n              this.setState({ filtersSel: this.state.filtersSel });\n            }}>新增條件</IonButton>\n            <IonButton fill='outline' shape='round' size='large' className='uiFont' onClick={e => {\n              this.filterRegExp = this.state.filtersSel.map((fs, i) => new RegExp(`.*${this.state.filtersSel[i].search}.*`));\n              this.animalsFiltered = this.props.tmpSettings.animals.filter(a => {\n                let match = true;\n                for (let i = 0; i < this.filterRegExp.length; i++) {\n                  const searchText = this.state.filtersSel[i].search;\n                  if (searchText !== '') {\n                    const key = this.state.filtersSel[i].key;\n                    const thisMatch = this.filterRegExp[i].test((a as any)[key]);\n                    match = match && thisMatch;\n                  }\n                }\n                return match;\n              });\n              this.fetachDataPageByPage(true);\n            }}>搜尋</IonButton>\n\n            <IonList>\n              {this.renderRows()}\n\n              <IonInfiniteScroll threshold=\"100px\"\n                disabled={!this.state.isScrollOn}\n                onIonInfinite={(ev: CustomEvent<void>) => {\n                  this.fetachDataPageByPage();\n                  (ev.target as HTMLIonInfiniteScrollElement).complete();\n                }}>\n                <IonInfiniteScrollContent\n                  loadingText=\"載入中...\">\n                </IonInfiniteScrollContent>\n              </IonInfiniteScroll>\n            </IonList>\n\n            <IonToast\n              cssClass='uiFont'\n              isOpen={this.state.showToast}\n              onDidDismiss={() => this.setState({ showToast: false })}\n              message={this.state.toastMessage}\n              duration={2000}\n            />\n          </IonContent>\n        </IonPage>\n    );\n  }\n};\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n    tmpSettings: state.tmpSettings,\n    settings: state.settings\n  }\n};\n\n//const mapDispatchToProps = {};\n\nconst ListScreen = withIonLifeCycle(_ListScreen);\n\nexport default connect(\n  mapStateToProps,\n)(ListScreen);\n","import React from 'react';\nimport { IonContent, IonHeader, IonPage, IonTitle, IonToolbar, withIonLifeCycle, IonButton, IonList, IonItem, IonIcon, IonToast, IonImg, IonLoading, IonLabel } from '@ionic/react';\nimport { RouteComponentProps } from 'react-router-dom';\nimport { connect } from 'react-redux';\n\nimport { Settings } from '../models/Settings';\nimport { TmpSettings } from '../models/TmpSettings';\n\nimport './Pages.css';\nimport { arrowBack, bookmark, shareSocial } from 'ionicons/icons';\n\nvar displayItems = [\n  { field: \"類型\", key: \"animal_kind\" },\n  { field: \"性別\", key: \"animal_sex\" },\n  { field: \"體型\", key: \"animal_bodytype\" },\n  { field: \"毛色\", key: \"animal_colour\" },\n  { field: \"年紀\", key: \"animal_age\" },\n  { field: \"狀態\", key: \"animal_status\" },\n  { field: \"是否絕育\", key: \"animal_sterilization\" },\n  { field: \"是否施打狂犬病疫苗\", key: \"animal_bacterin\" },\n  { field: \"流水編號\", key: \"animal_id\" },\n  { field: \"區域編號\", key: \"animal_subid\" },\n  { field: \"所屬收容所名稱\", key: \"shelter_name\" },\n  { field: \"地址\", key: \"shelter_address\" },\n  { field: \"聯絡電話\", key: \"shelter_tel\" },\n  { field: \"尋獲地\", key: \"animal_foundplace\" },\n  { field: \"實際所在地\", key: \"animal_place\" },\n  { field: \"開放認養時間(起)\", key: \"animal_opendate\" },\n  { field: \"開放認養時間(迄)\", key: \"animal_closeddate\" },\n  { field: \"資料異動時間\", key: \"animal_update\" },\n  { field: \"資料建立時間\", key: \"animal_createtime\" },\n  { field: \"所屬縣市代碼\", key: \"animal_area_pkid\" },\n  { field: \"所屬收容所代碼\", key: \"animal_shelter_pkid\" },\n  { field: \"網頁標題\", key: \"animal_title\" },\n  { field: \"資料備註\", key: \"animal_remark\" },\n  { field: \"其他說明\", key: \"animal_caption\" },\n  { field: \"圖片名稱(原始名稱)\", key: \"album_name\" },\n  { field: \"異動時間\", key: \"cDate\" },\n];\n\ninterface Props {\n  dispatch: Function;\n  settings: Settings;\n  tmpSettings: TmpSettings;\n}\n\ninterface State {\n  showToast: boolean;\n  toastMessage: string;\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n  tab: string;\n  animalId: string;\n}> { }\n\nclass _DetailScreen extends React.Component<PageProps, State> {\n  constructor(props: PageProps) {\n    super(props);\n    this.state = {\n      showToast: false,\n      toastMessage: '',\n    };\n\n  }\n\n  get animal() {\n    return this.props.tmpSettings.animals.find((a) => a.animal_id === +this.props.match.params.animalId);\n  }\n\n  addBookmarkHandler() {\n    this.props.dispatch({\n      type: \"ADD_BOOKMARK\",\n      bookmark: this.animal?.animal_id,\n    });\n    this.setState({ showToast: true, toastMessage: '書籤新增成功！' });\n  }\n\n  render() {\n    var rows = [];\n    if (this.animal != null) {\n      rows = [];\n      for (var i = 0; i < displayItems.length; i++) {\n        rows.push(<IonItem key={i} className='textFont'>{displayItems[i].field + \"：\" + (this.animal as any)[displayItems[i].key]}</IonItem>);\n      }\n    }\n\n    return (\n      this.props.tmpSettings.isLoading ?\n        <IonLoading\n          cssClass='uiFont'\n          isOpen={this.props.tmpSettings.isLoading}\n          message={'載入中...'}\n        />\n        :\n        <IonPage>\n          <IonHeader>\n            <IonToolbar>\n              <IonButton fill=\"clear\" slot='start' onClick={e => this.props.history.goBack()}>\n                <IonIcon icon={arrowBack} slot='icon-only' />\n              </IonButton>\n\n              <IonTitle className='uiFont'>詳細資訊</IonTitle>\n\n              <IonButton fill=\"clear\" slot='end' onClick={e => {\n                this.addBookmarkHandler();\n              }}>\n                <IonIcon icon={bookmark} slot='icon-only' />\n              </IonButton>\n\n              <IonButton fill=\"clear\" slot='end' onClick={e => {\n                this.props.dispatch({\n                  type: \"TMP_SET_KEY_VAL\",\n                  key: 'shareTextModal',\n                  val: {\n                    show: true,\n                    text: decodeURIComponent(window.location.href),\n                  },\n                });\n              }}>\n                <IonIcon icon={shareSocial} slot='icon-only' />\n              </IonButton>\n            </IonToolbar>\n          </IonHeader>\n          <IonContent style={{ textAlign: 'center' }}>\n            {this.animal == null ?\n              <IonLabel className='ion-text-wrap textFont'>此認養動物資料已不存在。</IonLabel>\n              :\n              <>\n                <IonImg src={this.animal?.album_file || ''} className='detailScreenImg' alt='' />\n                <IonList>\n                  {rows}\n                </IonList>\n              </>\n            }\n\n            <IonToast\n              cssClass='uiFont'\n              isOpen={this.state.showToast}\n              onDidDismiss={() => this.setState({ showToast: false })}\n              message={this.state.toastMessage}\n              duration={2000}\n            />\n          </IonContent>\n        </IonPage>\n    );\n  }\n}\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n    tmpSettings: state.tmpSettings,\n    settings: state.settings\n  }\n};\n\n//const mapDispatchToProps = {};\n\nconst DetailScreen = withIonLifeCycle(_DetailScreen);\n\nexport default connect(\n  mapStateToProps,\n)(DetailScreen);\n","import React from 'react';\nimport { IonContent, IonLabel, IonModal, IonProgressBar } from '@ionic/react';\nimport { RouteComponentProps } from 'react-router-dom';\nimport { connect } from 'react-redux';\n\ninterface Props {\n  item: string;\n  showModal: boolean;\n  progress: number;\n}\n\ninterface PageProps extends Props, RouteComponentProps<{\n}> { }\n\ninterface State {\n}\n\nclass _DownloadModal extends React.Component<PageProps, State> {\n\n  constructor(props: any) {\n    super(props);\n    this.state = {\n    }\n  }\n\n  render() {\n    return (\n      <IonModal\n        isOpen={this.props.showModal}\n        cssClass='uiFont'\n        backdropDismiss={false}\n        swipeToClose={false}\n      >\n        <IonContent>\n          <div style={{ display: 'flex', flexDirection: 'column', height: '100%', alignItems: 'center' }}>\n              <IonLabel className='ion-text-wrap uiFont'>{this.props.item}下載中，請等待。</IonLabel>\n              <IonProgressBar style={{ height: '40px' }} value={this.props.progress / 100} />\n              <IonLabel className='ion-text-wrap uiFont'>{Math.floor(this.props.progress)}%</IonLabel>\n          </div>\n        </IonContent>\n      </IonModal>\n    );\n  }\n};\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n  }\n};\n\n//const mapDispatchToProps = {};\n\nexport default connect(\n  mapStateToProps,\n)(_DownloadModal);\n","import React from 'react';\nimport { Redirect, Route, RouteComponentProps, withRouter } from 'react-router-dom';\nimport {\n  setupConfig,\n  IonApp,\n  IonIcon,\n  IonRouterOutlet,\n  IonTabBar,\n  IonTabButton,\n  IonTabs,\n  IonAlert,\n  IonToast,\n} from '@ionic/react';\nimport { IonReactRouter } from '@ionic/react-router';\nimport { connect, Provider } from 'react-redux';\nimport queryString from 'query-string';\nimport getSavedStore from './redux/store';\nimport { settings, bookmark, list } from 'ionicons/icons';\n\n/* Core CSS required for Ionic components to work properly */\nimport '@ionic/react/css/core.css';\n\n/* Basic CSS for apps built with Ionic */\nimport '@ionic/react/css/normalize.css';\nimport '@ionic/react/css/structure.css';\nimport '@ionic/react/css/typography.css';\n\n/* Optional CSS utils that can be commented out */\nimport '@ionic/react/css/padding.css';\nimport '@ionic/react/css/float-elements.css';\nimport '@ionic/react/css/text-alignment.css';\nimport '@ionic/react/css/text-transformation.css';\nimport '@ionic/react/css/flex-utils.css';\nimport '@ionic/react/css/display.css';\n\n/* Theme variables */\nimport './theme/variables.css';\nimport SettingsPage from './pages/SettingsPage';\nimport Globals from './Globals';\nimport ShareTextModal from './components/ShareTextModal';\nimport BookmarkPage from './pages/BookmarkPage';\nimport ListScreen from './pages/ListScreen';\nimport DetailScreen from './pages/DetailScreen';\nimport DownloadModal from './components/DownloadModal';\n\nconst electronBackendApi: any = (window as any).electronBackendApi;\n\nlet store = getSavedStore();\n/*\nclass DebugRouter extends IonReactRouter {\n  constructor(props: any) {\n    super(props);\n    console.log('initial history is: ', JSON.stringify(this.history, null, 2))\n    this.history.listen((location, action) => {\n      console.log(\n        `The current URL is ${location.pathname}${location.search}${location.hash}`\n      )\n      console.log(`The last navigation action was ${action}`, JSON.stringify(this.history, null, 2));\n    });\n  }\n}\n*/\n\nsetupConfig({\n  mode: 'md', // Use a consistent UI style across Android and iOS.\n  swipeBackEnabled: false,\n});\n\nexport var serviceWorkCallbacks = {\n  onSuccess: function (registration: ServiceWorkerRegistration) { },\n  onUpdate: function (registration: ServiceWorkerRegistration) { },\n};\n\ninterface Props {\n  dispatch: Function;\n  shareTextModal: any;\n  settings: any;\n}\n\ninterface PageProps extends RouteComponentProps<{\n  tab: string;\n  path: string;\n}> { }\n\ninterface AppOrigProps extends Props, RouteComponentProps<{\n  tab: string;\n  path: string;\n}> { }\n\ninterface State {\n  showToast: boolean;\n  toastMessage: string;\n  showUpdateAlert: boolean;\n  showRestoreAppSettingsToast: boolean;\n  downloadModal: any;\n}\n\nclass _App extends React.Component<PageProps> {\n  render() {\n    return (\n      <Provider store={store}>\n        <AppOrig {...this.props} />\n      </Provider>\n    );\n  }\n}\n\nclass _AppOrig extends React.Component<AppOrigProps, State> {\n  registrationNew: ServiceWorkerRegistration | null;\n  originalAppSettingsStr: string | null | undefined;\n\n  constructor(props: any) {\n    super(props);\n    if (!this.props.settings.hasAppLog) {\n      Globals.disableAppLog();\n    }\n\n    electronBackendApi?.receive(\"fromMain\", (data: any) => {\n      switch (data.event) {\n        case 'version':\n          store.dispatch({\n            type: \"TMP_SET_KEY_VAL\",\n            key: 'mainVersion',\n            val: data.version,\n          });\n          break;\n      }\n    });\n    electronBackendApi?.send(\"toMain\", { event: 'ready' });\n\n    this.registrationNew = null;\n\n    // ----- Initializing UI settings -----\n    // Apply the theme setting.\n    while (document.body.classList.length > 0) {\n      document.body.classList.remove(document.body.classList.item(0)!);\n    }\n    document.body.classList.toggle(`theme${this.props.settings.theme}`, true);\n\n    // Modify UI settings from query string.\n    const queryParams = queryString.parse(this.props.location.search) as any;\n    if (queryParams.settings) {\n      this.originalAppSettingsStr = localStorage.getItem(Globals.storeFile);\n      (queryParams.settings as string).split(',').forEach(setting => {\n        const keyVal = setting.split('=');\n        this.props.dispatch({\n          type: \"SET_KEY_VAL\",\n          key: keyVal[0],\n          val: +keyVal[1],\n        });\n      });\n    }\n    Globals.updateCssVars(this.props.settings);\n\n    this.state = {\n      showUpdateAlert: false,\n      showRestoreAppSettingsToast: (queryParams.settings != null && this.originalAppSettingsStr != null) || false,\n      showToast: false,\n      toastMessage: '',\n      downloadModal: { progress: 0, show: false }\n    };\n\n    serviceWorkCallbacks.onUpdate = (registration: ServiceWorkerRegistration) => {\n      this.registrationNew = registration;\n      this.setState({ showUpdateAlert: true });\n    };\n\n    serviceWorkCallbacks.onSuccess = (registration: ServiceWorkerRegistration) => {\n    };\n\n    // Preload speechSynthesis.\n    if (typeof speechSynthesis !== 'undefined') {\n      speechSynthesis.getVoices();\n      speechSynthesis.cancel();\n    }\n\n    // Enable screen wake lock.\n    if ((navigator as any).wakeLock) {\n      this.wakeLockScreen();\n      document.addEventListener(\"visibilitychange\", async () => {\n        if (document.visibilityState === 'visible') {\n          this.wakeLockScreen();\n        } else {\n          this.wakeLockScreenRelease()\n        }\n      });\n    }\n\n    const dbOpenReq = indexedDB.open(Globals.database);\n    // Init store in indexedDB if necessary.\n    dbOpenReq.onupgradeneeded = function (event: IDBVersionChangeEvent) {\n      var db = (event.target as any).result;\n      db.createObjectStore('store');\n      console.log(`DB store created.`);\n    };\n    this.loadData();\n  }\n\n  restoreAppSettings() {\n    localStorage.setItem(Globals.storeFile, this.originalAppSettingsStr!);\n    this.props.dispatch({ type: 'LOAD_SETTINGS' });\n    while (document.body.classList.length > 0) {\n      document.body.classList.remove(document.body.classList.item(0)!);\n    }\n    document.body.classList.toggle(`theme${this.props.settings.theme}`, true);\n    Globals.updateCssVars(this.props.settings);\n  }\n\n  async loadData() {\n    store.dispatch({\n      type: \"TMP_SET_KEY_VAL\",\n      key: 'isLoading',\n      val: true,\n    });\n\n    const item = '動物認養資料';\n    let data: any;\n    try {\n      data = await Globals.getFileFromIndexedDB(Globals.animalsKey);\n    } catch (err) {\n      this.setState({ downloadModal: { item: item, show: true, progress: 0 } });\n      const buffer = await Globals.downloadData(Globals.dataUrl, (progress: number) => {\n        this.setState({ downloadModal: { item: item, show: true, progress: progress } });\n      });\n      data = JSON.parse(buffer.toString());\n      this.setState({ downloadModal: { item: item, show: false, progress: 100 } });\n      Globals.saveFileToIndexedDB(Globals.animalsKey, data);\n    }\n    store.dispatch({\n      type: \"TMP_SET_KEY_VAL\",\n      key: 'animals',\n      val: data,\n    });\n    store.dispatch({\n      type: \"TMP_SET_KEY_VAL\",\n      key: 'isLoading',\n      val: false,\n    });\n  }\n\n  // Prevent device from sleeping.\n  wakeLock: any;\n  async wakeLockScreen() {\n    try {\n      const wakeLock = (navigator as any).wakeLock;\n      if (wakeLock != null) {\n        this.wakeLock = await wakeLock.request('screen');\n        console.log('Screen wake lock is requested.');\n      } else {\n        console.error('navigator.wakeLock is undefined.');\n      }\n    } catch (err) {\n      // the wake lock request fails - usually system related, such low as battery\n      console.log(`${err.name}, ${err.message}`);\n      console.log(new Error().stack);\n    }\n  }\n\n  async wakeLockScreenRelease() {\n    if (this.wakeLock != null) {\n      await this.wakeLock.release();\n      this.wakeLock = null;\n      console.log('Screen wake lock is released.');\n    }\n  }\n\n  routeByQueryString() {\n    // This app uses client side routing. \n    // Without the first loading of this app,\n    // any client side route becomes a server side route!\n    // These invalid server side routings cause 404 errors.\n    // To workaround these errors, we can use GitHub 404.html redirection\n    // to pass the client side routes to this app by using query string.\n    // After this app loads, it can use the query string to correctly redirect to\n    // a client side route!\n    console.log(window.location.search);\n    const routeMatches = /route=([^&]*)/.exec(window.location.search);\n    const queryMatches = /query=([^&]*)/.exec(window.location.search);\n    if (routeMatches !== null) {\n      const route = decodeURIComponent(routeMatches[1]);\n\n      let query = ''\n      if (queryMatches !== null) {\n        query = decodeURIComponent(queryMatches[1]);\n      }\n      return <Redirect to={route + query} />;\n    } else if (window.location.pathname === `${Globals.pwaUrl}` || window.location.pathname === `${Globals.pwaUrl}/`) {\n      return <Redirect to={`${Globals.pwaUrl}/bookmarks`} />;\n    }\n  }\n\n  render() {\n    return (\n      <IonApp>\n        <IonReactRouter>\n          <IonTabs>\n            <IonRouterOutlet animated={false}>\n              <Route path={`${Globals.pwaUrl}/:tab(bookmarks)`} render={(props: any) => <BookmarkPage {...props} />} exact={true} />\n              <Route path={`${Globals.pwaUrl}/:tab(animals)`} render={(props: any) => <ListScreen {...props} />} exact={true} />\n              <Route path={`${Globals.pwaUrl}/:tab(animals)/:animalId`} render={(props: any) => <DetailScreen {...props} />} exact={true} />\n              <Route path={`${Globals.pwaUrl}/settings`} render={(props: any) => <SettingsPage {...props} />} />\n              <Route path={`${Globals.pwaUrl}/`} render={() => { return this.routeByQueryString(); }} exact={true} />\n            </IonRouterOutlet>\n            <IonTabBar slot=\"bottom\">\n              <IonTabButton tab=\"bookmarks\" href={`${Globals.pwaUrl}/bookmarks`}>\n                <IonIcon icon={bookmark} />\n              </IonTabButton>\n              <IonTabButton tab=\"animals\" href={`${Globals.pwaUrl}/animals`}>\n                <IonIcon icon={list} />\n              </IonTabButton>\n              <IonTabButton tab=\"settings\" href={`${Globals.pwaUrl}/settings`}>\n                <IonIcon icon={settings} />\n              </IonTabButton>\n            </IonTabBar>\n          </IonTabs>\n        </IonReactRouter>\n        <IonAlert\n          cssClass='uiFont'\n          isOpen={this.state.showUpdateAlert}\n          backdropDismiss={false}\n          onDidPresent={(ev) => {\n            // Run SKIP_WAITING at onDidPresent event to avoid a race condition of\n            // an old page fetching old JS chunks with a new service worker!\n            this.registrationNew?.installing?.postMessage({ type: 'SKIP_WAITING' });\n            this.registrationNew?.waiting?.postMessage({ type: 'SKIP_WAITING' });\n          }}\n          header={'App 已更新，請重啟!'}\n          buttons={[\n            {\n              text: '關閉',\n              cssClass: 'primary uiFont',\n              handler: (value) => {\n                this.setState({\n                  showUpdateAlert: false,\n                });\n              },\n            }\n          ]}\n        />\n\n        <DownloadModal\n          {...{\n            item: this.state.downloadModal.item,\n            progress: this.state.downloadModal.progress,\n            showModal: this.state.downloadModal.show,\n            ...this.props\n          }}\n        />\n\n        <ShareTextModal\n          {...{\n            text: this.props.shareTextModal?.text,\n            showModal: this.props.shareTextModal?.show || false,\n            finish: () => {\n              store.dispatch({\n                type: \"TMP_SET_KEY_VAL\",\n                key: 'shareTextModal',\n                val: { show: false },\n              });\n            }, ...this.props\n          }}\n        />\n\n        <IonToast\n          cssClass='uiFont'\n          isOpen={this.state.showRestoreAppSettingsToast}\n          onDidDismiss={() => this.setState({ showRestoreAppSettingsToast: false })}\n          message={`已套用 app 連結中的設定，是否還原設定？`}\n          buttons={[\n            {\n              text: '取消',\n              role: 'cancel',\n              handler: () => this.setState({ showRestoreAppSettingsToast: false })\n            },\n            {\n              text: '還原',\n              handler: () => this.restoreAppSettings(),\n            },\n          ]}\n        />\n\n        <IonToast\n          cssClass='uiFont'\n          isOpen={this.state.showToast}\n          onDidDismiss={() => this.setState({ showToast: false })}\n          message={this.state.toastMessage}\n          duration={2000}\n        />\n      </IonApp>\n    );\n  }\n}\n\nconst mapStateToProps = (state: any /*, ownProps*/) => {\n  return {\n    shareTextModal: state.tmpSettings.shareTextModal,\n    settings: state.settings,\n  }\n};\n\nconst AppOrig = connect(\n  mapStateToProps,\n)(_AppOrig);\n\n\nconst App = withRouter(_App);\n\nexport default App;\n","import { /*applyMiddleware,*/ createStore, Store } from \"redux\";\n\n//import { logger } from \"redux-logger\"\n//import thunk from \"redux-thunk\"\n//import promise from \"redux-promise-middleware\"\n\nimport reducer from \"./reducers\";\nimport Globals from \"../Globals\";\n\n//const middleware = applyMiddleware(promise(), thunk, logger)\n\nvar savedStore: Store;\n\nexport default function getSavedStore() {\n    var savedSettingsStr = localStorage.getItem(Globals.storeFile);\n    if (savedSettingsStr != null) {\n        savedStore = createStore(reducer, JSON.parse(savedSettingsStr));//, middleware)\n    }\n    else {\n        savedStore = createStore(reducer);//, middleware)\n    }\n\n    return savedStore;\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://cra.link/PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n  // [::1] is the IPv6 localhost address.\n  window.location.hostname === '[::1]' ||\n  // 127.0.0.0/8 are considered localhost for IPv4.\n  window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n            'worker. To learn more, visit https://cra.link/PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      /*\n      if(registration.waiting) {\n        const reg = registration.waiting;\n        reg.postMessage({ type: 'SKIP_WAITING' });\n        alert('Skip waiting.');\n      }*/\n\n      registration.onupdatefound = () => {\n        //alert('onupdatefound.');\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          console.log(`installingWorker stage changed: ${installingWorker.state}`);\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                'tabs for this page are closed. See https://cra.link/PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log('No internet connection found. App is running in offline mode.');\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then((registration) => {\n        registration.unregister();\n      })\n      .catch((error) => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { BrowserRouter } from \"react-router-dom\";\nimport App, {serviceWorkCallbacks} from './App';\nimport Globals from './Globals';\nimport * as serviceWorker from './serviceWorkerRegistration';\n\n// Enable at the very start for logging most messages.\nGlobals.enableAppLog();\n\nReactDOM.render(<BrowserRouter><App /></BrowserRouter>, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.register({\n    onSuccess: (registration: ServiceWorkerRegistration) => { console.log('Precache app loaded!'); serviceWorkCallbacks.onSuccess(registration); },\n    onUpdate: (registration: ServiceWorkerRegistration) => { console.log('Found app updated!'); serviceWorkCallbacks.onUpdate(registration); },\n});\n"],"sourceRoot":""}